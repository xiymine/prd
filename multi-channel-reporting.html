<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤šæ¸ é“ä¸ŠæŠ¥ç­–ç•¥é…ç½®</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
      background: #f5f5f5;
    }

    .header {
      background: #409EFF;
      color: white;
      height: 60px;
      display: flex;
      align-items: center;
      padding: 0 20px;
      font-size: 20px;
      font-weight: bold;
    }

    .header .user-info {
      margin-left: auto;
      font-size: 14px;
      font-weight: normal;
    }

    .breadcrumb-bar {
      background: white;
      padding: 15px 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .breadcrumb {
      color: #606266;
      font-size: 14px;
    }

    .container {
      display: flex;
      min-height: calc(100vh - 60px);
    }

    .sidebar {
      width: 200px;
      background: white;
      padding: 20px 0;
    }

    .sidebar-item {
      padding: 12px 20px;
      color: #303133;
      cursor: pointer;
      transition: all 0.3s;
    }

    .sidebar-item:hover {
      background: #f5f7fa;
    }

    .sidebar-item.active {
      color: #409EFF;
      background: #ecf5ff;
      border-right: 3px solid #409EFF;
    }

    .content {
      flex: 1;
      padding: 20px;
      overflow-x: auto;
    }

    .main-card {
      background: white;
      border-radius: 4px;
      padding: 30px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      min-width: 1100px;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: #303133;
      margin-bottom: 25px;
      padding-bottom: 10px;
      border-bottom: 2px solid #DCDFE6;
    }

    .form-item {
      margin-bottom: 22px;
      display: flex;
      align-items: flex-start;
    }

    .form-label {
      width: 140px;
      text-align: right;
      padding-right: 12px;
      line-height: 40px;
      font-size: 14px;
      color: #606266;
    }

    .form-label.required::before {
      content: '*';
      color: #F56C6C;
      margin-right: 4px;
    }

    .form-content {
      flex: 1;
      display: flex;
      align-items: center;
    }

    .form-input {
      height: 40px;
      line-height: 40px;
      padding: 0 15px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 14px;
      width: 400px;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #409EFF;
    }

    .form-select {
      height: 40px;
      padding: 0 30px 0 15px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 14px;
      width: 400px;
      background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23909399" d="M2 4l4 4 4-4z"/></svg>') no-repeat;
      background-position: right 10px center;
      appearance: none;
      cursor: pointer;
    }

    .link-btn {
      margin-left: 10px;
      color: #409EFF;
      font-size: 14px;
      text-decoration: none;
      cursor: pointer;
    }

    .link-btn:hover {
      color: #66B1FF;
    }

    .estimate-count {
      font-size: 14px;
      color: #606266;
    }

    .time-display {
      display: inline-block;
      padding: 6px 10px;
      background: #F5F7FA;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 12px;
      color: #606266;
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.3s;
    }

    .time-display:hover {
      background: #E6F4FF;
      border-color: #409EFF;
      color: #409EFF;
    }

    .radio-group {
      display: flex;
      gap: 20px;
    }

    .radio-label {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 14px;
    }

    .radio-label input[type="radio"] {
      margin-right: 6px;
      width: 14px;
      height: 14px;
      cursor: pointer;
    }

    .demo-notice {
      background: #FFF7E6;
      border: 1px solid #FFD666;
      border-radius: 4px;
      padding: 12px 16px;
      margin-bottom: 20px;
      color: #AD6800;
      font-size: 13px;
    }

    .demo-notice strong {
      font-weight: bold;
      margin-right: 8px;
    }

    /* æ¸ é“é…ç½®è¡¨æ ¼ */
    .channel-config-section {
      margin-top: 30px;
    }

    .channel-table-wrapper {
      margin-top: 20px;
      border: 1px solid #EBEEF5;
      border-radius: 4px;
      overflow: hidden;
    }

    .channel-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    .channel-table thead {
      background: #F5F7FA;
    }

    .channel-table th {
      padding: 12px 8px;
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      color: #606266;
      border-bottom: 1px solid #EBEEF5;
      white-space: nowrap;
    }

    .channel-table td {
      padding: 12px 8px;
      font-size: 13px;
      color: #606266;
      border-bottom: 1px solid #EBEEF5;
      vertical-align: middle;
    }

    .channel-table tbody tr:hover {
      background: #F5F7FA;
    }

    .table-input {
      width: 100%;
      height: 32px;
      padding: 0 10px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 13px;
      transition: border-color 0.2s;
    }

    .table-input:focus {
      outline: none;
      border-color: #409EFF;
    }

    .table-select {
      width: 100%;
      height: 32px;
      padding: 0 25px 0 10px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 13px;
      background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23909399" d="M2 4l4 4 4-4z"/></svg>') no-repeat;
      background-position: right 8px center;
      appearance: none;
      cursor: pointer;
    }

    .table-number {
      width: 70px;
      height: 32px;
      padding: 0 8px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 13px;
      text-align: center;
    }

    .table-number:focus {
      outline: none;
      border-color: #409EFF;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #DCDFE6;
      transition: 0.3s;
      border-radius: 20px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #409EFF;
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .delete-btn {
      color: #F56C6C;
      cursor: pointer;
      font-size: 18px;
      border: none;
      background: none;
      padding: 4px;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      color: #F78989;
      transform: scale(1.2);
    }

    .add-channel-btn {
      width: 100%;
      height: 44px;
      border: 2px dashed #DCDFE6;
      background: white;
      border-radius: 4px;
      color: #409EFF;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
    }

    .add-channel-btn:hover {
      border-color: #409EFF;
      background: #ECF5FF;
    }

    .add-icon {
      font-size: 18px;
      font-weight: bold;
    }

    .btn-group {
      margin-top: 30px;
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid #EBEEF5;
    }

    .btn {
      padding: 10px 24px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #DCDFE6;
      background: white;
      margin: 0 8px;
      transition: all 0.3s;
    }

    .btn:hover {
      color: #409EFF;
      border-color: #C6E2FF;
      background: #ECF5FF;
    }

    .btn-primary {
      background: #409EFF;
      color: white;
      border-color: #409EFF;
    }

    .btn-primary:hover {
      background: #66B1FF;
      border-color: #66B1FF;
      color: white;
    }

    .btn-text {
      border: none;
      background: none;
      color: #409EFF;
      padding: 0;
      cursor: pointer;
      font-size: 13px;
    }

    .btn-text:hover {
      color: #66B1FF;
      text-decoration: underline;
    }

    .col-no {
      width: 50px;
      text-align: center;
    }

    .col-channel {
      min-width: 200px;
    }

    .col-status {
      width: 80px;
      text-align: center;
    }

    .col-click-rate {
      width: 120px;
    }

    .col-repeat {
      width: 110px;
    }

    .col-interval {
      min-width: 220px;
    }

    .col-time {
      min-width: 160px;
    }

    .col-actions {
      width: 60px;
      text-align: center;
    }

    /* é—´éš”é…ç½®æ˜¾ç¤º */
    .interval-summary {
      font-size: 12px;
      color: #606266;
      line-height: 1.5;
    }

    .interval-summary-text {
      background: #F5F7FA;
      padding: 4px 8px;
      border-radius: 3px;
      display: inline-block;
      margin-bottom: 4px;
      margin-right: 4px;
    }

    /* å¼¹çª—æ ·å¼ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 8px;
      width: 600px;
      max-height: 80vh;
      overflow: auto;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #EBEEF5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 16px;
      font-weight: bold;
      color: #303133;
    }

    .modal-close {
      font-size: 24px;
      color: #909399;
      cursor: pointer;
      border: none;
      background: none;
      padding: 0;
      width: 24px;
      height: 24px;
      line-height: 24px;
    }

    .modal-close:hover {
      color: #606266;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #EBEEF5;
      text-align: right;
    }

    .interval-config-item {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px;
      background: #F9FAFB;
      border-radius: 4px;
      border: 1px solid #E4E7ED;
    }

    .interval-label {
      width: 180px;
      font-size: 14px;
      color: #606266;
      flex-shrink: 0;
    }

    .interval-inputs {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .interval-number {
      width: 100px;
      height: 36px;
      padding: 0 10px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 14px;
      text-align: center;
    }

    .interval-number:focus {
      outline: none;
      border-color: #409EFF;
    }

    .interval-unit {
      width: 90px;
      height: 36px;
      padding: 0 25px 0 10px;
      border: 1px solid #DCDFE6;
      border-radius: 4px;
      font-size: 14px;
      background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23909399" d="M2 4l4 4 4-4z"/></svg>') no-repeat;
      background-position: right 8px center;
      appearance: none;
      cursor: pointer;
    }

    .interval-tip {
      font-size: 12px;
      color: #909399;
      margin-top: 8px;
      padding: 8px 12px;
      background: #FFF7E6;
      border-radius: 4px;
      line-height: 1.6;
    }

    .preview-box {
      margin-top: 20px;
      padding: 16px;
      background: #F0F9FF;
      border: 1px solid #B3E0FF;
      border-radius: 4px;
    }

    .preview-title {
      font-size: 13px;
      font-weight: bold;
      color: #409EFF;
      margin-bottom: 12px;
    }

    .preview-timeline {
      font-size: 13px;
      color: #606266;
      line-height: 2;
    }

    .preview-timeline div {
      padding-left: 20px;
      position: relative;
    }

    .preview-timeline div::before {
      content: 'â–¸';
      position: absolute;
      left: 0;
      color: #409EFF;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="header">
      <div>APPç”¨æˆ·è¿è¥ç³»ç»Ÿ</div>
      <div class="user-info">xiy</div>
    </div>

    <!-- é¢åŒ…å±‘ -->
    <div class="breadcrumb-bar">
      <div class="breadcrumb">
        å¹¿å‘Šä¸»ç®¡ç† / ä¸ŠæŠ¥ç­–ç•¥ç®¡ç† / ç¼–è¾‘ä¸ŠæŠ¥ç­–ç•¥
      </div>
      <button class="btn">è¿”å›ä¸Šä¸€é¡µ</button>
    </div>

    <!-- ä¸»ä½“å†…å®¹ -->
    <div class="container">
      <!-- ä¾§è¾¹æ  -->
      <div class="sidebar">
        <div class="sidebar-item">æ ‡ç­¾è§„åˆ™ç®¡ç†</div>
        <div class="sidebar-item active">ä¸ŠæŠ¥ç­–ç•¥ç®¡ç†</div>
      </div>

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="content">
        <div class="main-card">
          <!-- æç¤ºä¿¡æ¯ -->
          <div class="demo-notice">
            <strong>ğŸ’¡ è®¾è®¡è¯´æ˜ï¼š</strong>"ä»»åŠ¡æ‰§è¡Œé¢‘æ¬¡"å’Œ"ç‚¹å‡»æ¯”ä¾‹ç­–ç•¥"æ˜¯è§„åˆ™çº§é…ç½®ï¼Œå½±å“æ‰€æœ‰æ¸ é“ã€‚æ¯ä¸ªæ¸ é“å¯å•ç‹¬é…ç½®ç‚¹å‡»æ¯”ä¾‹ã€é‡å¤ä¸ŠæŠ¥æ¬¡æ•°å’ŒåŠ¨æ€é—´éš”æ—¶é—´ã€‚
          </div>

          <!-- æ ‡ç­¾è§„åˆ™ç®¡ç† -->
          <div class="section-title">æ ‡ç­¾è§„åˆ™ç®¡ç†</div>

          <div class="form-item">
            <div class="form-label required">è§„åˆ™åç§°</div>
            <div class="form-content">
              <input type="text" class="form-input" value="ç™¾åº¦ä¸»ç«¯-ç½‘æ˜“-å¤šæ¸ é“æµ‹è¯•" />
            </div>
          </div>

          <div class="form-item">
            <div class="form-label required">é€‰æ‹©æ ‡ç­¾è§„åˆ™</div>
            <div class="form-content">
              <select class="form-select">
                <option>ç™¾åº¦åŒç«¯-ç™¾åº¦-æœªè½¬åŒ–-è¿‡å»1å¤©</option>
              </select>
              <a href="#" class="link-btn">æŸ¥çœ‹è§„åˆ™è¯¦æƒ…</a>
            </div>
          </div>

          <div class="form-item">
            <div class="form-label">é¢„ä¼°äººç¾¤æ•°é‡</div>
            <div class="form-content">
              <span class="estimate-count">5045234</span>
            </div>
          </div>

          <!-- ä»»åŠ¡æ‰§è¡Œé¢‘æ¬¡ - è§„åˆ™çº§é…ç½® -->
          <div class="form-item">
            <div class="form-label required">ä»»åŠ¡æ‰§è¡Œé¢‘æ¬¡</div>
            <div class="form-content">
              <div class="radio-group">
                <label class="radio-label">
                  <input type="radio" name="globalFrequency" value="once" checked>
                  <span>ä»…ä¸€æ¬¡</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="globalFrequency" value="daily">
                  <span>æ¯æ—¥</span>
                </label>
              </div>
              <span style="margin-left: 15px; font-size: 13px; color: #909399;">
                æ­¤é…ç½®åº”ç”¨äºæ‰€æœ‰æ¸ é“å·
              </span>
            </div>
          </div>

          <!-- ä¸ŠæŠ¥æ—¶é—´ -->
          <div class="form-item">
            <div class="form-label required">ä¸ŠæŠ¥æ—¶é—´</div>
            <div class="form-content">
              <input type="text" class="form-input" value="" placeholder="é€‰æ‹©ä¸ŠæŠ¥æ—¶é—´" />
              <span style="margin-left: 15px; font-size: 13px; color: #909399;">
                è®¾ç½®ä»»åŠ¡çš„é¦–æ¬¡ä¸ŠæŠ¥æ—¶é—´
              </span>
            </div>
          </div>

          <!-- ç‚¹å‡»æ¯”ä¾‹ç­–ç•¥ - è§„åˆ™çº§é…ç½® -->
          <div class="form-item">
            <div class="form-label required">
              ç‚¹å‡»æ¯”ä¾‹ç­–ç•¥
            </div>
            <div class="form-content">
              <div class="radio-group">
                <label class="radio-label">
                  <input type="radio" name="clickRateStrategy" value="independent" checked>
                  <span>å…è®¸é‡å¤</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="clickRateStrategy" value="exclusive">
                  <span>äº’æ–¥å»é‡</span>
                </label>
              </div>
              <span style="margin-left: 15px; font-size: 13px; color: #909399; cursor: help;" title="å…è®¸é‡å¤ï¼šå„æ¸ é“å·ç‹¬ç«‹æŒ‰ç‚¹å‡»æ¯”ä¾‹ç­›é€‰ï¼ŒåŒä¸€ç”¨æˆ·å¯èƒ½è¢«å¤šä¸ªæ¸ é“å·ä¸ŠæŠ¥&#10;äº’æ–¥å»é‡ï¼šå¤šæ¸ é“å·é—´äº’æ–¥ï¼ŒåŒä¸€ç”¨æˆ·åªèƒ½è¢«ä¸€ä¸ªæ¸ é“å·ä¸ŠæŠ¥">
                â“˜ è®¾ç½®å¤šæ¸ é“å·ç‚¹å‡»æ¯”ä¾‹çš„å–æ•°é€»è¾‘
              </span>
            </div>
          </div>

          <!-- é…ç½®ä¸ŠæŠ¥è§„åˆ™ -->
          <div class="channel-config-section">
            <div class="section-title">
              é…ç½®ä¸ŠæŠ¥è§„åˆ™ï¼ˆæ¸ é“å·ç»´åº¦ï¼‰
              <span style="color: #909399; font-size: 13px; font-weight: normal; margin-left: 10px;">
                ï¼ˆå·²é…ç½® <span style="color: #409EFF; font-weight: bold;" id="channelCount">2</span> ä¸ªæ¸ é“å·ï¼‰
              </span>
            </div>

            <div class="channel-table-wrapper">
              <table class="channel-table">
                <thead>
                  <tr>
                    <th class="col-no">åºå·</th>
                    <th class="col-channel">æ¸ é“å·</th>
                    <th class="col-status">ç”Ÿæ•ˆçŠ¶æ€</th>
                    <th class="col-click-rate">ç‚¹å‡»æ¯”ä¾‹</th>
                    <th class="col-repeat">
                      é‡å¤ä¸ŠæŠ¥æ¬¡æ•°
                    </th>
                    <th class="col-interval">
                      ä¸ŠæŠ¥é—´éš”é…ç½®
                    </th>
                    <th class="col-time">ä¸ŠæŠ¥æ—¶æ®µ</th>
                    <th class="col-actions">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody id="channelTableBody">
                  <!-- æ¸ é“1 -->
                  <tr data-intervals='[{"value":10,"unit":"second"},{"value":20,"unit":"second"}]'>
                    <td class="col-no">1</td>
                    <td class="col-channel">
                      <select class="table-select">
                        <option>XM01850 / ç½‘æ˜“æœ‰é“</option>
                        <option>XM01851 / è…¾è®¯å¹¿å‘Š</option>
                        <option>XM01852 / å­—èŠ‚è·³åŠ¨</option>
                      </select>
                    </td>
                    <td class="col-status">
                      <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                      </label>
                    </td>
                    <td class="col-click-rate">
                      <input type="number" class="table-number" value="30" min="0" max="100" step="1" />
                      <span style="margin-left: 4px; font-size: 12px; color: #909399;">%</span>
                    </td>
                    <td class="col-repeat">
                      <input type="number" class="table-number repeat-count" value="3" min="1" max="100" onchange="updateIntervalConfig(this)" />
                      <span style="margin-left: 4px; font-size: 12px; color: #909399;">æ¬¡</span>
                    </td>
                    <td class="col-interval">
                      <div class="interval-summary">
                        <div class="interval-summary-text">1â†’2: 10ç§’</div>
                        <div class="interval-summary-text">2â†’3: 20ç§’</div>
                        <div style="margin-top: 4px;">
                          <button class="btn-text" onclick="openIntervalModal(this)">ğŸ“ é…ç½®é—´éš”</button>
                        </div>
                      </div>
                    </td>
                    <td class="col-time">
                      <span class="time-display" onclick="editTimeHours(this)" title="ç‚¹å‡»ç¼–è¾‘ä¸ŠæŠ¥æ—¶æ®µ">0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23</span>
                    </td>
                    <td class="col-actions">
                      <button class="delete-btn" onclick="deleteRow(this)" title="åˆ é™¤">âœ•</button>
                    </td>
                  </tr>

                  <!-- æ¸ é“2 -->
                  <tr data-intervals='[{"value":5,"unit":"minute"},{"value":10,"unit":"minute"},{"value":15,"unit":"minute"},{"value":20,"unit":"minute"}]'>
                    <td class="col-no">2</td>
                    <td class="col-channel">
                      <select class="table-select">
                        <option>XM01851 / è…¾è®¯å¹¿å‘Š</option>
                        <option>XM01850 / ç½‘æ˜“æœ‰é“</option>
                        <option>XM01852 / å­—èŠ‚è·³åŠ¨</option>
                      </select>
                    </td>
                    <td class="col-status">
                      <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                      </label>
                    </td>
                    <td class="col-click-rate">
                      <input type="number" class="table-number" value="50" min="0" max="100" step="1" />
                      <span style="margin-left: 4px; font-size: 12px; color: #909399;">%</span>
                    </td>
                    <td class="col-repeat">
                      <input type="number" class="table-number repeat-count" value="5" min="1" max="100" onchange="updateIntervalConfig(this)" />
                      <span style="margin-left: 4px; font-size: 12px; color: #909399;">æ¬¡</span>
                    </td>
                    <td class="col-interval">
                      <div class="interval-summary">
                        <div class="interval-summary-text">1â†’2: 5åˆ†é’Ÿ</div>
                        <div class="interval-summary-text">2â†’3: 10åˆ†é’Ÿ</div>
                        <div class="interval-summary-text">3â†’4: 15åˆ†é’Ÿ</div>
                        <div class="interval-summary-text">4â†’5: 20åˆ†é’Ÿ</div>
                        <div style="margin-top: 4px;">
                          <button class="btn-text" onclick="openIntervalModal(this)">ğŸ“ é…ç½®é—´éš”</button>
                        </div>
                      </div>
                    </td>
                    <td class="col-time">
                      <span class="time-display" onclick="editTimeHours(this)" title="ç‚¹å‡»ç¼–è¾‘ä¸ŠæŠ¥æ—¶æ®µ">0,2,4,6,8,10,12,14,16,18,20,22</span>
                    </td>
                    <td class="col-actions">
                      <button class="delete-btn" onclick="deleteRow(this)" title="åˆ é™¤">âœ•</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- æ–°å¢æ¸ é“å·æŒ‰é’® -->
            <button class="add-channel-btn" onclick="addChannel()">
              <span class="add-icon">+</span>
              <span>æ–°å¢æ¸ é“å·é…ç½®</span>
            </button>
          </div>

          <!-- æŒ‰é’®ç»„ -->
          <div class="btn-group">
            <button class="btn">å–æ¶ˆ</button>
            <button class="btn btn-primary" onclick="submitForm()">ä¿å­˜é…ç½®</button>
          </div>
        </div>
      </div>
    </div>

    <!-- é—´éš”é…ç½®å¼¹çª— -->
    <div class="modal-overlay" id="intervalModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">é…ç½®ä¸ŠæŠ¥é—´éš”æ—¶é—´</div>
          <button class="modal-close" onclick="closeIntervalModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="interval-tip">
            ğŸ’¡ <strong>è¯´æ˜ï¼š</strong>é‡å¤ä¸ŠæŠ¥ <span id="modalRepeatCount">3</span> æ¬¡ï¼Œéœ€è¦é…ç½® <span id="modalIntervalCount">2</span> ä¸ªé—´éš”æ—¶é—´ã€‚
          </div>
          <div id="intervalConfigList">
            <!-- åŠ¨æ€ç”Ÿæˆé—´éš”é…ç½®é¡¹ -->
          </div>
          <div class="preview-box">
            <div class="preview-title">â± ä¸ŠæŠ¥æ—¶é—´çº¿é¢„è§ˆ</div>
            <div class="preview-timeline" id="previewTimeline">
              <!-- åŠ¨æ€ç”Ÿæˆé¢„è§ˆ -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeIntervalModal()">å–æ¶ˆ</button>
          <button class="btn btn-primary" onclick="saveIntervalConfig()">ç¡®å®š</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let channelIndex = 2;
    let currentEditingRow = null;

    // åˆ é™¤è¡Œ
    function deleteRow(btn) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¸ é“å·é…ç½®å—ï¼Ÿ')) {
        const row = btn.closest('tr');
        row.style.opacity = '0';
        setTimeout(() => {
          row.remove();
          updateRowNumbers();
        }, 300);
      }
    }

    // æ–°å¢æ¸ é“å·
    function addChannel() {
      channelIndex++;
      const tbody = document.getElementById('channelTableBody');

      const newRow = document.createElement('tr');
      newRow.setAttribute('data-intervals', '[{"value":5,"unit":"minute"}]');
      newRow.style.opacity = '0';

      newRow.innerHTML = `
        <td class="col-no">${channelIndex}</td>
        <td class="col-channel">
          <select class="table-select">
            <option>è¯·é€‰æ‹©æ¸ é“å·</option>
            <option>XM01850 / ç½‘æ˜“æœ‰é“</option>
            <option>XM01851 / è…¾è®¯å¹¿å‘Š</option>
            <option>XM01852 / å­—èŠ‚è·³åŠ¨</option>
          </select>
        </td>
        <td class="col-status">
          <label class="switch">
            <input type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </td>
        <td class="col-click-rate">
          <input type="number" class="table-number" value="0" min="0" max="100" step="1" />
          <span style="margin-left: 4px; font-size: 12px; color: #909399;">%</span>
        </td>
        <td class="col-repeat">
          <input type="number" class="table-number repeat-count" value="2" min="1" max="100" onchange="updateIntervalConfig(this)" />
          <span style="margin-left: 4px; font-size: 12px; color: #909399;">æ¬¡</span>
        </td>
        <td class="col-interval">
          <div class="interval-summary">
            <div class="interval-summary-text">1â†’2: 5åˆ†é’Ÿ</div>
            <div style="margin-top: 4px;">
              <button class="btn-text" onclick="openIntervalModal(this)">ğŸ“ é…ç½®é—´éš”</button>
            </div>
          </div>
        </td>
        <td class="col-time">
          <span class="time-display" onclick="editTimeHours(this)" title="ç‚¹å‡»ç¼–è¾‘ä¸ŠæŠ¥æ—¶æ®µ">0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23</span>
        </td>
        <td class="col-actions">
          <button class="delete-btn" onclick="deleteRow(this)" title="åˆ é™¤">âœ•</button>
        </td>
      `;

      tbody.appendChild(newRow);

      setTimeout(() => {
        newRow.style.transition = 'opacity 0.3s';
        newRow.style.opacity = '1';
      }, 10);

      updateRowNumbers();
    }

    // æ›´æ–°è¡Œå·
    function updateRowNumbers() {
      const rows = document.querySelectorAll('#channelTableBody tr');
      rows.forEach((row, index) => {
        row.querySelector('.col-no').textContent = index + 1;
      });
      document.getElementById('channelCount').textContent = rows.length;
      channelIndex = rows.length;
    }

    // ç¼–è¾‘ä¸ŠæŠ¥æ—¶æ®µ
    function editTimeHours(span) {
      alert('ç‚¹å‡»ç¼–è¾‘ä¸ŠæŠ¥æ—¶æ®µ\n\nè¿™é‡Œå¯ä»¥å¼¹å‡ºæ—¶æ®µé€‰æ‹©å™¨ï¼Œè®©ç”¨æˆ·é€‰æ‹©0-23å°æ—¶çš„æ—¶æ®µ');
      // TODO: å®ç°æ—¶æ®µé€‰æ‹©å™¨å¼¹çª—
    }

    // å½“é‡å¤æ¬¡æ•°æ”¹å˜æ—¶ï¼Œæ›´æ–°é—´éš”é…ç½®
    function updateIntervalConfig(input) {
      const repeatCount = parseInt(input.value);
      if (repeatCount < 1 || repeatCount > 100) return;

      const row = input.closest('tr');
      const intervalCount = repeatCount - 1;

      // è·å–å½“å‰é—´éš”é…ç½®
      let intervals = JSON.parse(row.getAttribute('data-intervals') || '[]');

      // è°ƒæ•´é—´éš”æ•°ç»„é•¿åº¦
      if (intervals.length < intervalCount) {
        // å¢åŠ é—´éš”
        for (let i = intervals.length; i < intervalCount; i++) {
          intervals.push({value: 5, unit: 'minute'});
        }
      } else if (intervals.length > intervalCount) {
        // å‡å°‘é—´éš”
        intervals = intervals.slice(0, intervalCount);
      }

      row.setAttribute('data-intervals', JSON.stringify(intervals));
      updateIntervalSummary(row);
    }

    // æ›´æ–°é—´éš”æ‘˜è¦æ˜¾ç¤º
    function updateIntervalSummary(row) {
      const intervals = JSON.parse(row.getAttribute('data-intervals') || '[]');
      const summaryDiv = row.querySelector('.interval-summary');
      const unitMap = {
        'second': 'ç§’',
        'minute': 'åˆ†é’Ÿ',
        'hour': 'å°æ—¶',
        'day': 'å¤©'
      };

      let html = '';
      intervals.forEach((interval, index) => {
        const unitText = unitMap[interval.unit] || interval.unit;
        html += `<div class="interval-summary-text">${index + 1}â†’${index + 2}: ${interval.value}${unitText}</div>`;
      });
      html += '<div style="margin-top: 4px;"><button class="btn-text" onclick="openIntervalModal(this)">ğŸ“ é…ç½®é—´éš”</button></div>';

      summaryDiv.innerHTML = html;
    }

    // æ‰“å¼€é—´éš”é…ç½®å¼¹çª—
    function openIntervalModal(btn) {
      const row = btn.closest('tr');
      currentEditingRow = row;

      const repeatCount = parseInt(row.querySelector('.repeat-count').value);
      const intervalCount = repeatCount - 1;
      const intervals = JSON.parse(row.getAttribute('data-intervals') || '[]');

      document.getElementById('modalRepeatCount').textContent = repeatCount;
      document.getElementById('modalIntervalCount').textContent = intervalCount;

      // ç”Ÿï¿½ï¿½ï¿½é—´éš”é…ç½®é¡¹
      const configList = document.getElementById('intervalConfigList');
      configList.innerHTML = '';

      for (let i = 0; i < intervalCount; i++) {
        const interval = intervals[i] || {value: 5, unit: 'minute'};
        const div = document.createElement('div');
        div.className = 'interval-config-item';
        div.innerHTML = `
          <div class="interval-label">ç¬¬ ${i + 1} æ¬¡ â†’ ç¬¬ ${i + 2} æ¬¡</div>
          <div class="interval-inputs">
            <input type="number" class="interval-number" value="${interval.value}" min="1" max="9999" data-index="${i}" onchange="updatePreview()" />
            <select class="interval-unit" data-index="${i}" onchange="updatePreview()">
              <option value="second" ${interval.unit === 'second' ? 'selected' : ''}>ç§’</option>
              <option value="minute" ${interval.unit === 'minute' ? 'selected' : ''}>åˆ†é’Ÿ</option>
              <option value="hour" ${interval.unit === 'hour' ? 'selected' : ''}>å°æ—¶</option>
              <option value="day" ${interval.unit === 'day' ? 'selected' : ''}>å¤©</option>
            </select>
          </div>
        `;
        configList.appendChild(div);
      }

      updatePreview();
      document.getElementById('intervalModal').classList.add('show');
    }

    // å…³é—­å¼¹çª—
    function closeIntervalModal() {
      document.getElementById('intervalModal').classList.remove('show');
      currentEditingRow = null;
    }

    // ä¿å­˜é—´éš”é…ç½®
    function saveIntervalConfig() {
      if (!currentEditingRow) return;

      const intervals = [];
      const numbers = document.querySelectorAll('.interval-number');
      const units = document.querySelectorAll('.interval-unit');

      numbers.forEach((input, index) => {
        intervals.push({
          value: parseInt(input.value),
          unit: units[index].value
        });
      });

      currentEditingRow.setAttribute('data-intervals', JSON.stringify(intervals));
      updateIntervalSummary(currentEditingRow);
      closeIntervalModal();
    }

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      const numbers = document.querySelectorAll('.interval-number');
      const units = document.querySelectorAll('.interval-unit');
      const timeline = document.getElementById('previewTimeline');

      const unitMap = {
        'second': 'ç§’',
        'minute': 'åˆ†é’Ÿ',
        'hour': 'å°æ—¶',
        'day': 'å¤©'
      };

      let html = '<div>ç¬¬ 1 æ¬¡ä¸ŠæŠ¥: åŸºå‡†æ—¶é—´ (T)</div>';
      let accumulatedSeconds = 0;

      numbers.forEach((input, index) => {
        const value = parseInt(input.value) || 0;
        const unit = units[index].value;
        const unitText = unitMap[unit];

        // è½¬æ¢ä¸ºç§’
        const multiplier = {
          'second': 1,
          'minute': 60,
          'hour': 3600,
          'day': 86400
        };
        accumulatedSeconds += value * multiplier[unit];

        // æ ¼å¼åŒ–ç´¯è®¡æ—¶é—´
        let timeStr = '';
        if (accumulatedSeconds < 60) {
          timeStr = `T+${accumulatedSeconds}ç§’`;
        } else if (accumulatedSeconds < 3600) {
          timeStr = `T+${Math.floor(accumulatedSeconds / 60)}åˆ†${accumulatedSeconds % 60}ç§’`;
        } else if (accumulatedSeconds < 86400) {
          const hours = Math.floor(accumulatedSeconds / 3600);
          const minutes = Math.floor((accumulatedSeconds % 3600) / 60);
          timeStr = `T+${hours}å°æ—¶${minutes}åˆ†`;
        } else {
          const days = Math.floor(accumulatedSeconds / 86400);
          const hours = Math.floor((accumulatedSeconds % 86400) / 3600);
          timeStr = `T+${days}å¤©${hours}å°æ—¶`;
        }

        html += `<div>ç¬¬ ${index + 2} æ¬¡ä¸ŠæŠ¥: ${timeStr} <span style="color: #909399;">(+${value}${unitText})</span></div>`;
      });

      timeline.innerHTML = html;
    }

    // æäº¤è¡¨å•
    function submitForm() {
      // è·å–è§„åˆ™çº§é…ç½®
      const globalFrequency = document.querySelector('input[name="globalFrequency"]:checked').value;
      const clickRateStrategy = document.querySelector('input[name="clickRateStrategy"]:checked').value;

      const channels = [];
      const rows = document.querySelectorAll('#channelTableBody tr');

      rows.forEach((row, index) => {
        const intervals = JSON.parse(row.getAttribute('data-intervals') || '[]');
        const clickRateInputs = row.querySelectorAll('.col-click-rate .table-number');
        const clickRate = clickRateInputs.length > 0 ? clickRateInputs[0].value : '0';

        const channelData = {
          index: index + 1,
          channel: row.querySelector('.table-select').value,
          isActive: row.querySelector('.switch input').checked,
          clickRate: clickRate,
          repeatCount: row.querySelector('.repeat-count').value,
          intervals: intervals,
          reportHours: row.querySelector('.col-time .time-display').textContent,
        };
        channels.push(channelData);
      });

      const formData = {
        ruleName: document.querySelector('.form-input').value,
        executionFrequency: globalFrequency,  // è§„åˆ™çº§é…ç½®
        clickRateStrategy: clickRateStrategy,  // è§„åˆ™çº§é…ç½®ï¼šç‚¹å‡»æ¯”ä¾‹ç­–ç•¥
        channels: channels
      };

      console.log('æäº¤çš„é…ç½®æ•°æ®ï¼š', formData);

      const freqText = globalFrequency === 'daily' ? 'æ¯æ—¥' : 'ä»…ä¸€æ¬¡';
      const strategyText = clickRateStrategy === 'independent' ? 'å…è®¸é‡å¤ï¼ˆå„æ¸ é“å·ç‹¬ç«‹ç­›é€‰ï¼‰' : 'äº’æ–¥å»é‡ï¼ˆåŒä¸€ç”¨æˆ·åªèƒ½è¢«ä¸€ä¸ªæ¸ é“ä¸ŠæŠ¥ï¼‰';
      let summary = `è§„åˆ™é…ç½®ï¼š\n`;
      summary += `è§„åˆ™åç§°ï¼š${formData.ruleName}\n`;
      summary += `ä»»åŠ¡æ‰§è¡Œé¢‘æ¬¡ï¼š${freqText}ï¼ˆåº”ç”¨äºæ‰€æœ‰æ¸ é“å·ï¼‰\n`;
      summary += `ç‚¹å‡»æ¯”ä¾‹ç­–ç•¥ï¼š${strategyText}\n\n`;
      summary += `æ¸ é“å·é…ç½®ï¼ˆ${channels.length}ä¸ªï¼‰ï¼š\n\n`;

      channels.forEach(ch => {
        summary += `æ¸ é“å· ${ch.index}ï¼š${ch.channel}\n`;
        summary += `  çŠ¶æ€ï¼š${ch.isActive ? 'å¼€å¯' : 'å…³é—­'}\n`;
        summary += `  ç‚¹å‡»æ¯”ä¾‹ï¼š${ch.clickRate}%\n`;
        summary += `  é‡å¤ä¸ŠæŠ¥ï¼š${ch.repeatCount}æ¬¡\n`;
        summary += `  é—´éš”é…ç½®ï¼š\n`;
        ch.intervals.forEach((interval, idx) => {
          const unitMap = {'second': 'ç§’', 'minute': 'åˆ†é’Ÿ', 'hour': 'å°æ—¶', 'day': 'å¤©'};
          summary += `    ç¬¬${idx + 1}â†’${idx + 2}æ¬¡: ${interval.value}${unitMap[interval.unit]}\n`;
        });
        summary += `  ä¸ŠæŠ¥æ—¶æ®µï¼š${ch.reportHours}\n\n`;
      });

      alert(summary + 'ç‚¹å‡»ç¡®å®šå°†æäº¤åˆ°åç«¯ä¿å­˜');
    }
  </script>
</body>
</html>
